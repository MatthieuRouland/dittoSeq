# dittoSeq Demuxlet tools:

Included in this package are a set of functions to facilitate Mux-seq applications. For more information on Demuxlet and Mux-sequencing, see the [Demuxlet GitHub Page](https://github.com/statgen/demuxlet). (Impetus: Many Mux-seq experiments will involve generating the side-by-side bulk and single-cell RNAseq data like the rest of the package is built for.)

## Seurat Import Function:

**`importDemux2Seurat()`** - imports Demuxlet info into a pre-made Seurat object.

To get started, point it to the target Seurat object, the location of your Demuxlet .best output, and pick between these two methods:

### Option1: Use this if your data was generated by 10X and lanes have been merged together using `cellranger aggr`

This option makes use of the "-1", "-2", "-3", ..., that cellranger aggr adds to the end of your cell barcodes in order to keep the lanes separate.

I recommend running demuxlet for each lane separately as these "-#"s are not updated within the BAM files.

`importDemux2Seurat()` can take in multiple demuxlet.best file locations, and will then modify the unchanged "-1" in demuxlet's barcodes to the aggr-consistent "-#" based on the order in which they are supplied.

```
library(Seurat)
library(DittoSeq)
#Make a Seurat from your 10X Data
Object <- CreateSeuratObject(Read10X("Location.of.cellranger.outs"))

#Run the import
  #Note: You can leave Lane.names blank, but if you choose to use custom names, make
  #      sure to provied the same number of Lane.names as you had separate 10X lanes.
Object <- importDemux2Seurat(Object,
                             Lane.names = c("name1","name2","name3"),
                             Demuxlet.best = c(
                                 "Location/Demuxlet1.best",
                                 "Location/Demuxlet2.best",
                                 "Location/Demuxlet3.best"),
                             verbose = TRUE)
```

### Option2: Use this if your multiple lane data was not generated by `cellranger` or not merged with `cellranger aggr`

For this option, you need to have pre-made a meta.data slot that includes info on which cells belonged to which lane. 

```
library(Seurat)
library(dittoSeq)

#Make a lane info meta.data
Object@meta.data$LANE.INFO <- LANE.INFO

#Run the import
  #Note: You can leave Lane.names blank, but if you choose to use custom names, make
  #      sure to provied the same number of Lane.names as you had separate 10X lanes.
Object <- importDemux2Seurat(Object,
                             Lane.info.meta = "LANE.INFO"
                             Lane.names = c("name1","name2","name3"),
                             Demuxlet.best = "Location/Demuxlet.best",
                             verbose = TRUE)
```

### Summary output:
The import function spits out a quick summary of what was done, which will look something like this:

```
Adding 'Lane' information as meta.data
Extracting the Demuxlet calls
Matching barcodes
Adding Demuxlet info as metadata
Checking for barcode duplicates across lanes...
  No barcode duplicates were found.

SUMMARY:
2 lanes were identified and named:
  g1, g2
The average number of SNPs per cell for all lanes was: 505.3
Out of 80 cells in the Seurat object, Demuxlet assigned:
    75 cells or 93.8% as singlets
    4 cells or 5% as doublets
    and 1 cells as too ambiguous to call.
0 cells were not annotated in the demuxlet.best file.
```

## Summary Plotting Functions

-	**`demux.calls.summary()`** - Makes a plot of how many calls were made per sample, separated by the separate lanes.  This is very useful for checking the potential accuracy of sample calls when only certain samples went into certain lanes/pools/sequencing runs/etc.  (Note: the default setting is to only show Singlet calls.  Use `singlets.only = FALSE` to include *one of the sample calls* for any doublets.

-	**`demux.SNP.summary()`** - Useful for checking if you have a lot of cells with very few SNPs. Creates a plot of the number of SNPs per cell that is grouped by individual lane by default.  This function is a simple wrapper for DBPlot() function with var="demux.N.SNP" and with a number of input defaults adjusted (such as group.by and color.by = "Lane" so that the grouping is done according to 'Lane' metadata.)

-	Both of these work with the same object=DEFAULT shortcut as all other dittoSeq functions, 

Examples:

```
library(Seurat)
library(dittoSeq)

#Method1
demux.SNP.summary(Seurat.object)
demux.calls.summary(Seurat.object)

#Method2
DEFAULT <- "Seurat.object"
demux.SNP.summary()
demux.calls.summary()
```

## Metadata created:

Metadata slot name | Description OR the Demuxlet.best column name if directly carried over
--- | ---
Lane | guided by Lane.names import input, represents of separate droblet-generation lane, pool, sequencing lane, etc.
Sample | The sample call, from the BEST column
demux.doublet.call | whether the sample was a singlet (SNG), doublet (DBL), or ambiguious (AMB), from the BEST column
demux.RD.TOTL | RD.TOTL
demux.RD.PASS | RD.PASS
demux.RD.UNIQ | RD.UNIQ
demux.N.SNP | N.SNP
demux.PRB.DBL | PRB.DBL
demux.barcode.dup | (Only generated when TRUEs will exist, indicative of a technical issue in the bioinformatics pipeline) whether a cell's barcode refered to only 1 row of the .best file, but multiple distinct cells in the dataset.
